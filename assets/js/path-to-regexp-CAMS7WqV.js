var b={};Object.defineProperty(b,"__esModule",{value:!0});b.TokenData=void 0;b.parse=U;var se=b.compile=Z;b.match=te;b.pathToRegexp=V;const L="/",_=t=>t,X=new RegExp("^\\p{XID_Continue}$","u"),O="https://git.new/pathToRegexpError",q={"!":"!","@":"@",";":";",",":",","*":"*","+":"+","?":"?","{":"{","}":"}"};function Q(t){const r=[...t],e=[];let n=0;for(;n<r.length;){const o=r[n],i=q[o];if(i){e.push({type:i,index:n++,value:o});continue}if(o==="\\"){e.push({type:"ESCAPED",index:n++,value:r[n++]});continue}if(o===":"){let c="";for(;X.test(r[++n]);)c+=r[n];if(!c)throw new TypeError(`Missing parameter name at ${n}`);e.push({type:"NAME",index:n,value:c});continue}if(o==="("){const c=n++;let u=1,a="";if(r[n]==="?")throw new TypeError(`Pattern cannot start with "?" at ${n}`);for(;n<r.length;){if(r[n]==="\\"){a+=r[n++]+r[n++];continue}if(r[n]===")"){if(u--,u===0){n++;break}}else if(r[n]==="("&&(u++,r[n+1]!=="?"))throw new TypeError(`Capturing groups are not allowed at ${n}`);a+=r[n++]}if(u)throw new TypeError(`Unbalanced pattern at ${c}`);if(!a)throw new TypeError(`Missing pattern at ${c}`);e.push({type:"PATTERN",index:n,value:a});continue}e.push({type:"CHAR",index:n,value:r[n++]})}return e.push({type:"END",index:n,value:""}),new Y(e)}class Y{constructor(r){this.tokens=r,this.index=0}peek(){return this.tokens[this.index]}tryConsume(r){const e=this.peek();if(e.type===r)return this.index++,e.value}consume(r){const e=this.tryConsume(r);if(e!==void 0)return e;const{type:n,index:o}=this.peek();throw new TypeError(`Unexpected ${n} at ${o}, expected ${r}: ${O}`)}text(){let r="",e;for(;e=this.tryConsume("CHAR")||this.tryConsume("ESCAPED");)r+=e;return r}modifier(){return this.tryConsume("?")||this.tryConsume("*")||this.tryConsume("+")}}class S{constructor(r,e){this.tokens=r,this.delimiter=e}}b.TokenData=S;function U(t,r={}){const{encodePath:e=_,delimiter:n=e(L)}=r,o=[],i=Q(t);let c=0;do{const u=i.text();u&&o.push(e(u));const a=i.tryConsume("NAME"),l=i.tryConsume("PATTERN");if(a||l){o.push({name:a||String(c++),pattern:l});const p=i.peek();if(p.type==="*")throw new TypeError(`Unexpected * at ${p.index}, you probably want \`/*\` or \`{/:foo}*\`: ${O}`);continue}if(i.tryConsume("*")){o.push({name:String(c++),pattern:`(?:(?!${N(n)}).)*`,modifier:"*",separator:n});continue}if(i.tryConsume("{")){const p=i.text(),m=i.tryConsume("NAME"),v=i.tryConsume("PATTERN"),h=i.text(),y=i.tryConsume(";")&&i.text();i.consume("}");const x=i.modifier();o.push({name:m||(v?String(c++):""),prefix:e(p),suffix:e(h),pattern:v,modifier:x,separator:y});continue}i.consume("END");break}while(!0);return new S(o,n)}function Z(t,r={}){const e=t instanceof S?t:U(t,r);return ee(e,r)}function k(t,r){if(typeof t=="string")return()=>t;const e=r||_,n=t.modifier==="+"||t.modifier==="*",o=t.modifier==="?"||t.modifier==="*",{prefix:i="",suffix:c="",separator:u=c+i}=t;if(r&&n){const l=(f,p)=>{if(typeof f!="string")throw new TypeError(`Expected "${t.name}/${p}" to be a string`);return e(f)},s=f=>{if(!Array.isArray(f))throw new TypeError(`Expected "${t.name}" to be an array`);return f.length===0?"":i+f.map(l).join(u)+c};return o?f=>{const p=f[t.name];return p==null?"":p.length?s(p):""}:f=>{const p=f[t.name];return s(p)}}const a=l=>{if(typeof l!="string")throw new TypeError(`Expected "${t.name}" to be a string`);return i+e(l)+c};return o?l=>{const s=l[t.name];return s==null?"":a(s)}:l=>{const s=l[t.name];return a(s)}}function ee(t,r){const{encode:e=encodeURIComponent,loose:n=!0,validate:o=!0,strict:i=!1}=r,c=F(r),u=H(n,t.delimiter),a=W(t,u,[],c,i),l=t.tokens.map((s,f)=>{const p=k(s,e);if(!o||typeof s=="string")return p;const m=new RegExp(`^${a[f]}$`,c);return v=>{const h=p(v);if(!m.test(h))throw new TypeError(`Invalid value for "${s.name}": ${JSON.stringify(h)}`);return h}});return function(f={}){let p="";for(const m of l)p+=m(f);return p}}function te(t,r={}){const{decode:e=decodeURIComponent,loose:n=!0,delimiter:o=L}=r,i=V(t,r),c=H(n,o),u=i.keys.map(a=>{if(e&&(a.modifier==="+"||a.modifier==="*")){const{prefix:l="",suffix:s="",separator:f=s+l}=a,p=new RegExp(c(f),"g");return m=>m.split(p).map(e)}return e||_});return function(l){const s=i.exec(l);if(!s)return!1;const{0:f,index:p}=s,m=Object.create(null);for(let v=1;v<s.length;v++){if(s[v]===void 0)continue;const h=i.keys[v-1],y=u[v-1];m[h.name]=y(s[v])}return{path:f,index:p,params:m}}}function N(t){return t.replace(/[.+*?^${}()[\]|/\\]/g,"\\$&")}function re(t,r){const e=N(t);return r?`(?:${e})+(?!${e})`:e}function H(t,r){if(!t)return N;const e=new RegExp(`(?:(?!${N(r)}).)+|(.)`,"g");return n=>n.replace(e,re)}function F(t){return t.sensitive?"":"i"}function j(t,r,e,n){const o=t instanceof S?t:U(t,n),{trailing:i=!0,loose:c=!0,start:u=!0,end:a=!0,strict:l=!1}=n,s=H(c,o.delimiter),f=W(o,s,r,e,l);let p=u?"^":"";return p+=f.join(""),i&&(p+=`(?:${s(o.delimiter)}$)?`),p+=a?"$":`(?=${N(o.delimiter)}|$)`,p}function W(t,r,e,n,o){const i=`(?:(?!${N(t.delimiter)}).)+?`;let c="",u=!0;return t.tokens.map(a=>{if(typeof a=="string")return c=a,r(a);const{prefix:l="",suffix:s="",separator:f=s+l,modifier:p=""}=a,m=r(l),v=r(s);if(a.name){const h=a.pattern?`(?:${a.pattern})`:i,y=ne(h,a.name,n);if(u||(u=I(y,l||c)),!u)throw new TypeError(`Ambiguous pattern for "${a.name}": ${O}`);if(u=!o||I(y,s),c="",e.push(a),p==="+"||p==="*"){const x=p==="*"?"?":"",T=r(f);if(!T)throw new TypeError(`Missing separator for "${a.name}": ${O}`);if(u||(u=!o||I(y,f)),!u)throw new TypeError(`Ambiguous pattern for "${a.name}" separator: ${O}`);return u=!o,`(?:${m}(${h}(?:${T}${h})*)${v})${x}`}return`(?:${m}(${h})${v})${p}`}return`(?:${m}${v})${p}`})}function ne(t,r,e){try{return new RegExp(`^${t}$`,e)}catch(n){throw new TypeError(`Invalid pattern for "${r}": ${n.message}`)}}function I(t,r){return r?!t.test(r):!1}function V(t,r={}){const e=[],n=F(r);if(Array.isArray(t)){const i=t.map(c=>j(c,e,n,r));return Object.assign(new RegExp(i.join("|")),{keys:e})}const o=j(t,e,n,r);return Object.assign(new RegExp(o),{keys:e})}function ie(t){for(var r=[],e=0;e<t.length;){var n=t[e];if(n==="*"||n==="+"||n==="?"){r.push({type:"MODIFIER",index:e,value:t[e++]});continue}if(n==="\\"){r.push({type:"ESCAPED_CHAR",index:e++,value:t[e++]});continue}if(n==="{"){r.push({type:"OPEN",index:e,value:t[e++]});continue}if(n==="}"){r.push({type:"CLOSE",index:e,value:t[e++]});continue}if(n===":"){for(var o="",i=e+1;i<t.length;){var c=t.charCodeAt(i);if(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||c===95){o+=t[i++];continue}break}if(!o)throw new TypeError("Missing parameter name at ".concat(e));r.push({type:"NAME",index:e,value:o}),e=i;continue}if(n==="("){var u=1,a="",i=e+1;if(t[i]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(i));for(;i<t.length;){if(t[i]==="\\"){a+=t[i++]+t[i++];continue}if(t[i]===")"){if(u--,u===0){i++;break}}else if(t[i]==="("&&(u++,t[i+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(i));a+=t[i++]}if(u)throw new TypeError("Unbalanced pattern at ".concat(e));if(!a)throw new TypeError("Missing pattern at ".concat(e));r.push({type:"PATTERN",index:e,value:a}),e=i;continue}r.push({type:"CHAR",index:e,value:t[e++]})}return r.push({type:"END",index:e,value:""}),r}function z(t,r){r===void 0&&(r={});for(var e=ie(t),n=r.prefixes,o=n===void 0?"./":n,i=r.delimiter,c=i===void 0?"/#?":i,u=[],a=0,l=0,s="",f=function(E){if(l<e.length&&e[l].type===E)return e[l++].value},p=function(E){var g=f(E);if(g!==void 0)return g;var $=e[l],M=$.type,K=$.index;throw new TypeError("Unexpected ".concat(M," at ").concat(K,", expected ").concat(E))},m=function(){for(var E="",g;g=f("CHAR")||f("ESCAPED_CHAR");)E+=g;return E},v=function(E){for(var g=0,$=c;g<$.length;g++){var M=$[g];if(E.indexOf(M)>-1)return!0}return!1},h=function(E){var g=u[u.length-1],$=E||(g&&typeof g=="string"?g:"");if(g&&!$)throw new TypeError('Must have text between two parameters, missing text after "'.concat(g.name,'"'));return!$||v($)?"[^".concat(C(c),"]+?"):"(?:(?!".concat(C($),")[^").concat(C(c),"])+?")};l<e.length;){var y=f("CHAR"),x=f("NAME"),T=f("PATTERN");if(x||T){var w=y||"";o.indexOf(w)===-1&&(s+=w,w=""),s&&(u.push(s),s=""),u.push({name:x||a++,prefix:w,suffix:"",pattern:T||h(w),modifier:f("MODIFIER")||""});continue}var d=y||f("ESCAPED_CHAR");if(d){s+=d;continue}s&&(u.push(s),s="");var A=f("OPEN");if(A){var w=m(),R=f("NAME")||"",D=f("PATTERN")||"",P=m();p("CLOSE"),u.push({name:R||(D?a++:""),pattern:R&&!D?h(w):D,prefix:w,suffix:P,modifier:f("MODIFIER")||""});continue}p("END")}return u}function C(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function B(t){return t&&t.sensitive?"":"i"}function oe(t,r){if(!r)return t;for(var e=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,o=e.exec(t.source);o;)r.push({name:o[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),o=e.exec(t.source);return t}function ae(t,r,e){var n=t.map(function(o){return J(o,r,e).source});return new RegExp("(?:".concat(n.join("|"),")"),B(e))}function ce(t,r,e){return G(z(t,e),r,e)}function G(t,r,e){e===void 0&&(e={});for(var n=e.strict,o=n===void 0?!1:n,i=e.start,c=i===void 0?!0:i,u=e.end,a=u===void 0?!0:u,l=e.encode,s=l===void 0?function(g){return g}:l,f=e.delimiter,p=f===void 0?"/#?":f,m=e.endsWith,v=m===void 0?"":m,h="[".concat(C(v),"]|$"),y="[".concat(C(p),"]"),x=c?"^":"",T=0,w=t;T<w.length;T++){var d=w[T];if(typeof d=="string")x+=C(s(d));else{var A=C(s(d.prefix)),R=C(s(d.suffix));if(d.pattern)if(r&&r.push(d),A||R)if(d.modifier==="+"||d.modifier==="*"){var D=d.modifier==="*"?"?":"";x+="(?:".concat(A,"((?:").concat(d.pattern,")(?:").concat(R).concat(A,"(?:").concat(d.pattern,"))*)").concat(R,")").concat(D)}else x+="(?:".concat(A,"(").concat(d.pattern,")").concat(R,")").concat(d.modifier);else{if(d.modifier==="+"||d.modifier==="*")throw new TypeError('Can not repeat "'.concat(d.name,'" without a prefix and suffix'));x+="(".concat(d.pattern,")").concat(d.modifier)}else x+="(?:".concat(A).concat(R,")").concat(d.modifier)}}if(a)o||(x+="".concat(y,"?")),x+=e.endsWith?"(?=".concat(h,")"):"$";else{var P=t[t.length-1],E=typeof P=="string"?y.indexOf(P[P.length-1])>-1:P===void 0;o||(x+="(?:".concat(y,"(?=").concat(h,"))?")),E||(x+="(?=".concat(y,"|").concat(h,")"))}return new RegExp(x,B(e))}function J(t,r,e){return t instanceof RegExp?oe(t,r):Array.isArray(t)?ae(t,r,e):ce(t,r,e)}const ue=Object.freeze(Object.defineProperty({__proto__:null,parse:z,pathToRegexp:J,tokensToRegexp:G},Symbol.toStringTag,{value:"Module"}));export{se as c,ue as i};
